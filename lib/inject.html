<script>
  (function() {
    var times = 0
    function socket() {
      var ws = new WebSocket('ws://'+ location.host)
      ws.onmessage = function(e) {
        e = e.data
        console.log(e)
        if (e === 'reload') {
          location.reload()
        }
        if (e === 'css') {
          var sheets = [].slice.call(document.getElementsByTagName('link'))
          var head = document.getElementsByTagName('head')[0]
          for (var i = 0; i < sheets.length; i += 1) {
            var elem = sheets[i]
            var rel = elem.rel
            var href = elem.href
            if (rel === 'stylesheet') {
              head.removeChild(elem)
              href = href.split('?')[0]
              elem.href = href + '?_=' + (+new Date())
              head.appendChild(elem)
            }
          }
        }
      }
      ws.onopen = function(e) {
        console.info('Socket connected')
      }
      ws.onclose = function(e) {
        if (times <= 10) {
          times += 1
          console.error('Socket closed, reconnecting...')
          setTimeout(socket, 5000)
        } else {
          console.info('Socket connect fail, Please refresh the browser')
        }
      }
    }
    socket()
  })()
  </script>
